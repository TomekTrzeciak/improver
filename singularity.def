Bootstrap: docker
From: debian:10

%files

environment.yml /opt

%post

apt update -y
apt upgrade -y
apt install -y git make bzip2 curl

cd /opt
CONDA_BASE=https://repo.continuum.io/miniconda/Miniconda
curl -L -o miniconda.sh ${CONDA_BASE}3-latest-Linux-x86_64.sh
bash miniconda.sh -b -p /opt/conda
rm miniconda.sh

eval "$(/opt/conda/bin/conda shell.bash hook)"
conda update -n base -c defaults conda
conda env update --name base --file /opt/environment.yml
pip install codacy-coverage codecov clize sigtools
conda clean -afy

%test

eval "$(/opt/conda/bin/conda shell.bash hook)"
python -c 'import iris; print(iris.__version__)'

%environment

export PATH="/opt/conda/bin:$PATH"
eval "$(/opt/conda/bin/conda shell.bash hook)"

%help

Container setup using conda and environment.yml from IMPROVER repository
