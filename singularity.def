Bootstrap: docker
From: debian:10

%files

environment.yml /opt

%post

apt update -y
apt upgrade -y
apt install -y bash git make bzip2 curl

cd /opt
CONDA_BASE=https://repo.continuum.io/miniconda/Miniconda
curl -L -o miniconda.sh ${CONDA_BASE}3-latest-Linux-x86_64.sh
bash miniconda.sh -b -p /opt/conda
rm miniconda.sh

eval "$(/opt/conda/bin/conda shell.bash hook)"
conda env create --name impr --file /opt/environment.yml
conda activate impr
pip install codacy-coverage codecov clize sigtools
conda clean -afy

%test

eval "$(/opt/conda/bin/conda shell.bash hook)"
conda activate impr
python -c 'import iris; print(iris.__version__)'

%environment

eval "$(/opt/conda/bin/conda shell.bash hook)"
conda activate impr

%help

Container setup using conda and environment.yml from IMPROVER repository
